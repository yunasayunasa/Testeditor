
<!-- manual.html -->

<h1>アクションタグ・リファレンス</h1>
<p>イベントに応じて、オブジェクトに様々なアクションを実行させるための命令です。</p>

<h2>[destroy]</h2>
<p>オブジェクトを破壊（シーンから削除）します。</p>
<ul>
    <li><strong>target</strong> (オプション): 破壊する対象を指定します。
        <ul>
            <li><code>self</code> (デフォルト): このイベントを持つオブジェクト自身。</li>
            <li><code>other</code>: このイベントを引き起こした衝突相手。</li>
            <li><code>オブジェクト名</code>: シーン上の特定の名前を持つオブジェクト。</li>
        </ul>
    </li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>[destroy]
[destroy target=self]
[destroy target=other]
[destroy target=secret_door]
</code></pre>

<hr>

<h2>[eval]</h2>
<p>ゲーム変数 (f.) やシステム変数 (sf.) を操作するJavaScript式を実行します。</p>
<ul>
    <li><strong>exp</strong> (必須): 実行する式を、必ずダブルクォーテーションで囲んで記述します。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>[eval exp="f.score = f.score + 10"]
[eval exp="f.has_key = true"]</code></pre>

<hr>

<h2>[tween]</h2>
<p>オブジェクトのプロパティを、滑らかに変化させるアニメーション（トゥイーン）を再生します。このタグは処理に時間がかかるため、<code>ActionInterpreter</code>はアニメーションが完了するまで次のタグの実行を待ちます。</p>

<h4>パラメータ:</h4>
<ul>
    <li>
        <strong>property</strong> (必須): 変化させたいプロパティ名。
        <br>例: <code>x</code>, <code>y</code>, <code>scale</code>, <code>scaleX</code>, <code>scaleY</code>, <code>angle</code>, <code>alpha</code>
    </li>
    <li>
        <strong>to</strong> (必須): 目標となる値。<code>"+=100"</code>や<code>"-=50"</code>といった相対値も指定可能です。
    </li>
    <li>
        <strong>time</strong> (任意): アニメーション時間（ミリ秒）。デフォルトは<code>1000</code> (1秒)。
    </li>
    <li>
        <strong>ease</strong> (任意): 動きの緩急。デフォルトは<code>Linear</code> (等速)。
        <br>例: <code>Sine.easeIn</code>, <code>Bounce.easeOut</code>, <code>Elastic.easeOut</code>
    </li>
    <li>
        <strong>yoyo</strong> (任意): <code>true</code>にすると、アニメーションが終点に達した後、始点まで逆再生します。心臓の鼓動のような表現に使えます。
    </li>
</ul>

<p><strong>使用例:</strong></p>
<pre><code>; 1秒かけて右に200ピクセル移動
[tween property=x to="+=200" time=1000]

; 0.5秒かけて、跳ねながらY座標500の位置に着地
[tween property=y to=500 time=500 ease=Bounce.easeOut]

; 0.3秒かけて1.5倍に拡大する
[tween property=scale to=1.5 time=300]
</code></pre>

<hr>

<h2>[apply_force]</h2>
<p>対象オブジェクトに物理的な「力」を加えます。オブジェクトは慣性や摩擦に従って加速します。ノックバックや、ジャンプの補助などに最適です。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>x</strong> (任意): X方向に加える力の大きさ。正の値で右、負の値で左。</li>
    <li><strong>y</strong> (任意): Y方向に加える力の大きさ。正の値で下、負の値で上。</li>
</ul>
<p><strong>注意:</strong> このタグは、<code>[body_velocity]</code>と異なり、現在の速度に力を「加算」します。値を大きくしすぎると、オブジェクトがすごい勢いで飛んでいく可能性があります。</p>
<p><strong>使用例:</strong></p>
<pre><code>; 敵に踏まれた時、上に少しだけ跳ね返る
[apply_force y=-0.05]

; 爆風で右に吹き飛ばされる
[apply_force x=0.2]
</code></pre>

<hr>

<h2>[body_velocity]</h2>
<p>対象オブジェクトの物理ボディの速度 (Velocity) を直接設定します。物理的な挙動を強制的に変更したい場合に使います。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>x</strong> (任意): X方向の速度を設定します。</li>
    <li><strong>y</strong> (任意): Y方向の速度を設定します。</li>
</ul>
<p><strong>注意:</strong> XとY、どちらか一方だけの指定も可能です。指定されなかった方向の速度は、現在の値を維持します。</p>
<p><strong>使用例:</strong></p>
<pre><code>; 右方向に速さ5で押し出す
[body_velocity x=5]

; 上方向に強く打ち上げる
[body_velocity y=-15]

; 右斜め上にジャンプさせる
[body_velocity x=7 y=-12]
</code></pre>

<hr>

<h2>[anim_play]</h2>
<p>対象オブジェクトのスプライトアニメーションを再生します。対象はスプライトである必要があります。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>name</strong> (必須): 再生したいアニメーションの名前（キー）を指定します。アニメーションは、あらかじめシーンのJSONで定義されている必要があります。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>; "walk" という名前のアニメーションを再生
[anim_play name=walk]

; "jump_attack" という名前のアニメーションを再生
[anim_play name=jump_attack]
</code></pre>

<hr>

<h2>[set_visible]</h2>
<p>対象オブジェクトの表示・非表示を切り替えます。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>value</strong> (必須): <code>true</code>で表示、<code>false</code>で非表示にします。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>; オブジェクトを非表示にする
[set_visible value=false]

; オブジェクトを再表示する
[set_visible value=true]
</code></pre>
<!-- ====================================================== -->
<h2>カスタムイベントトリガー (エディタ)</h2>
<p>PlayerControllerのような特定のコンポーネントが、自身の状態変化を知らせるために発行する、独自のイベントです。これにより、オブジェクトの内部状態とアニメーションやサウンドを、エディタだけで簡単に関連付けることができます。</p>
<!-- ====================================================== -->

<h3>onStateChange</h3>
<p><code>PlayerController</code>コンポーネントが、自身の状態（<code>idle</code>, <code>walk</code>, <code>jump_up</code>, <code>fall_down</code>）を変更した瞬間に一度だけ発火します。</p>
<h4>利用可能な変数 (Condition欄):</h4>
<ul>
    <li>
        <strong><code>state</code></strong>: 遷移先の<strong>新しい</strong>状態名（文字列）。
        <br>例: <code>'idle'</code>, <code>'walk'</code>, <code>'jump_up'</code>, <code>'fall_down'</code>
    </li>
    <li>
        <strong><code>oldState</code></strong>: 遷移元の<strong>古い</strong>状態名（文字列）。
    </li>
</ul>

<p><strong>使用例 (アニメーション連携):</strong></p>
<pre><code>
--- イベント1: 歩き始め ---
Trigger: onStateChange
Condition: state === 'walk'
Actions: [anim_play name=walk_animation]

--- イベント2: 停止 ---
Trigger: onStateChange
Condition: state === 'idle'
Actions: [anim_frame name=walk_animation frame=0]

--- イベント3: 歩行終了時 ---
Trigger: onStateChange
Condition: oldState === 'walk'
Actions: [anim_stop]
</code></pre>

<hr>

<h3>onDirectionChange</h3>
<p><code>PlayerController</code>コンポーネントが、キャラクターの向き（<code>left</code>, <code>right</code>）を変更した瞬間に一度だけ発火します。</p>
<h4>利用可能な変数 (Condition欄):</h4>
<ul>
    <li>
        <strong><code>direction</code></strong>: 新しい向き（文字列）。
        <br>例: <code>'left'</code>, <code>'right'</code>
    </li>
</ul>

<p><strong>使用例 (左右反転):</strong></p>
<pre><code>
--- イベント1: 左を向いた時 ---
Trigger: onDirectionChange
Condition: direction === 'left'
Actions: [set_flip_x value=true]

--- イベント2: 右を向いた時 ---
Trigger: onDirectionChange
Condition: direction === 'right'
Actions: [set_flip_x value=false]
</code></pre>
