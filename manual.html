
<!-- manual.html -->

<h1>アクションタグ・リファレンス</h1>
<p>イベントに応じて、オブジェクトに様々なアクションを実行させるための命令です。</p>

<hr>

<h2>[time_stop]</h2>
<p>ゲーム全体の時間を停止させます。物理演算、Tween、タイマーなど、時間経過に依存する全てのものが停止します。アクションステージの冒頭などに用います。</p>
<p><strong>注意:</strong> このタグは、<code>onReady</code>トリガーと併用するのが最も安全で効果的です。これにより、シーンの全てのオブジェクトが生成された直後に時間が停止し、予期せぬ挙動を防ぎます。</p>
<p><strong>パラメータ:</strong> なし</p>
<p><strong>使用例:</strong></p>
<pre><code>
--- イベント (オブジェクト "OpeningEvent" に設定) ---
Trigger: onReady
Actions: [time_stop]
</code></pre>

<hr>

<h2>[time_resume]</h2>
<p><code>[time_stop]</code>によって停止されたゲーム全体の時間を再開させます。通常、UIボタン（例：「イベント開始」ボタン）が押された際の<code>onClick</code>イベントと連携して使用されます。</p>
<p><strong>パラメータ:</strong> なし</p>
<p><strong>使用例:</strong></p>
<pre><code>
--- イベント (オブジェクト "StartButton" に設定) ---
Trigger: onClick
Actions: [time_resume][destroy target=self]
</code></pre>

<hr>

<h2>[spawn_object]</h2>
<p>あらかじめ定義された「プレハブ（設計図）」に基づいて、新しいオブジェクトをシーンに出現させます。弾の発射、アイテムのドロップ、敵の出現など、動的なゲームプレイの核となるタグです。</p>
<p>プレハブは、<code>assets/data/prefabs/</code>フォルダ内に、単一のオブジェクト定義を持つJSONファイルとして作成します。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>prefab</strong> (必須): 出現させたいプレハブのキー（JSONファイル名から拡張子を除いたもの）。</li>
    <li><strong>name</strong> (任意): 出現するオブジェクトに固有の名前を付けたい場合に指定します。指定しない場合、<code>prefab名_タイムスタンプ</code>という名前が自動で付きます。</li>
    <li><strong>offsetX, offsetY</strong> (任意): タグを実行したオブジェクトの位置を基準とした、出現位置のオフセット（ずれ）を指定します。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>; 敵を倒した時に、その場に"coin"プレハブのオブジェクトを出現させる
[spawn_object prefab=coin]

; プレイヤーの右手側(X座標+50)から、"bullet"プレハブの弾を発射する
[spawn_object prefab=bullet offsetX=50]
</code></pre>

<hr>

<h2>[set_flip_x]</h2>
<p>対象オブジェクトを左右に反転させます。キャラクターが左右を向くアニメーションの代わりとして、あるいはそれと組み合わせて使用します。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>value</strong> (必須): <code>true</code>で左右反転（左向き）、<code>false</code>で通常表示（右向き）にします。</li>
</ul>
<p><strong>使用例 (onDirectionChangeと連携):</strong></p>
<pre><code>
--- イベント1: 左を向いた時 ---
Trigger: onDirectionChange
Condition: direction === 'left'
Actions: [set_flip_x value=true]

--- イベント2: 右を向いた時 ---
Trigger: onDirectionChange
Condition: direction === 'right'
Actions: [set_flip_x value=false]
</code></pre>

<hr>

<h2>[anim_stop]</h2>
<p>対象オブジェクトで現在再生中のスプライトアニメーションを停止し、その時点のフレームで静止させます。</p>
<p><strong>パラメータ:</strong> なし</p>
<p><strong>使用例:</strong></p>
<pre><code>
--- イベント: 歩行が中断された時 ---
Trigger: onStateChange
Condition: oldState === 'walk'
Actions: [anim_stop]
</code></pre>

<hr>

<h2>[anim_frame]</h2>
<p>対象オブジェクトを、特定のアニメーションの、特定のフレームで静止させます。アニメーションを再生することなく、キャラクターの「立ち絵」として特定のポーズを表示させたい場合に非常に便利です。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>name</strong> (必須): 参照したいアニメーションの名前（キー）を指定します。</li>
    <li><strong>frame</strong> (必須): 表示したいフレームの番号（0から始まる）。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>
; "walk"アニメーションの最初のフレーム(立ちポーズ)で静止させる
[anim_frame name=walk frame=0]

; "attack"アニメーションの3番目のフレーム(剣を振りかぶったポーズ)で静止させる
[anim_frame name=attack frame=2]
</code></pre>

<h2>[destroy]</h2>
<p>オブジェクトを破壊（シーンから削除）します。</p>
<ul>
    <li><strong>target</strong> (オプション): 破壊する対象を指定します。
        <ul>
            <li><code>self</code> (デフォルト): このイベントを持つオブジェクト自身。</li>
            <li><code>other</code>: このイベントを引き起こした衝突相手。</li>
            <li><code>オブジェクト名</code>: シーン上の特定の名前を持つオブジェクト。</li>
        </ul>
    </li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>[destroy]
[destroy target=self]
[destroy target=other]
[destroy target=secret_door]
</code></pre>

<hr>

<h2>[eval]</h2>
<p>ゲーム変数 (f.) やシステム変数 (sf.) を操作するJavaScript式を実行します。</p>
<ul>
    <li><strong>exp</strong> (必須): 実行する式を、必ずダブルクォーテーションで囲んで記述します。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>[eval exp="f.score = f.score + 10"]
[eval exp="f.has_key = true"]</code></pre>

<hr>

<h2>[tween]</h2>
<p>オブジェクトのプロパティを、滑らかに変化させるアニメーション（トゥイーン）を再生します。このタグは処理に時間がかかるため、<code>ActionInterpreter</code>はアニメーションが完了するまで次のタグの実行を待ちます。</p>

<h4>パラメータ:</h4>
<ul>
    <li>
        <strong>property</strong> (必須): 変化させたいプロパティ名。
        <br>例: <code>x</code>, <code>y</code>, <code>scale</code>, <code>scaleX</code>, <code>scaleY</code>, <code>angle</code>, <code>alpha</code>
    </li>
    <li>
        <strong>to</strong> (必須): 目標となる値。<code>"+=100"</code>や<code>"-=50"</code>といった相対値も指定可能です。
    </li>
    <li>
        <strong>time</strong> (任意): アニメーション時間（ミリ秒）。デフォルトは<code>1000</code> (1秒)。
    </li>
    <li>
        <strong>ease</strong> (任意): 動きの緩急。デフォルトは<code>Linear</code> (等速)。
        <br>例: <code>Sine.easeIn</code>, <code>Bounce.easeOut</code>, <code>Elastic.easeOut</code>
    </li>
    <li>
        <strong>yoyo</strong> (任意): <code>true</code>にすると、アニメーションが終点に達した後、始点まで逆再生します。心臓の鼓動のような表現に使えます。
    </li>
</ul>

<p><strong>使用例:</strong></p>
<pre><code>; 1秒かけて右に200ピクセル移動
[tween property=x to="+=200" time=1000]

; 0.5秒かけて、跳ねながらY座標500の位置に着地
[tween property=y to=500 time=500 ease=Bounce.easeOut]

; 0.3秒かけて1.5倍に拡大する
[tween property=scale to=1.5 time=300]
</code></pre>

<hr>

<h2>[apply_force]</h2>
<p>対象オブジェクトに物理的な「力」を加えます。オブジェクトは慣性や摩擦に従って加速します。ノックバックや、ジャンプの補助などに最適です。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>x</strong> (任意): X方向に加える力の大きさ。正の値で右、負の値で左。</li>
    <li><strong>y</strong> (任意): Y方向に加える力の大きさ。正の値で下、負の値で上。</li>
</ul>
<p><strong>注意:</strong> このタグは、<code>[body_velocity]</code>と異なり、現在の速度に力を「加算」します。値を大きくしすぎると、オブジェクトがすごい勢いで飛んでいく可能性があります。</p>
<p><strong>使用例:</strong></p>
<pre><code>; 敵に踏まれた時、上に少しだけ跳ね返る
[apply_force y=-0.05]

; 爆風で右に吹き飛ばされる
[apply_force x=0.2]
</code></pre>

<hr>

<h2>[body_velocity]</h2>
<p>対象オブジェクトの物理ボディの速度 (Velocity) を直接設定します。物理的な挙動を強制的に変更したい場合に使います。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>x</strong> (任意): X方向の速度を設定します。</li>
    <li><strong>y</strong> (任意): Y方向の速度を設定します。</li>
</ul>
<p><strong>注意:</strong> XとY、どちらか一方だけの指定も可能です。指定されなかった方向の速度は、現在の値を維持します。</p>
<p><strong>使用例:</strong></p>
<pre><code>; 右方向に速さ5で押し出す
[body_velocity x=5]

; 上方向に強く打ち上げる
[body_velocity y=-15]

; 右斜め上にジャンプさせる
[body_velocity x=7 y=-12]
</code></pre>

<hr>

<h2>[anim_play]</h2>
<p>対象オブジェクトのスプライトアニメーションを再生します。対象はスプライトである必要があります。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>name</strong> (必須): 再生したいアニメーションの名前（キー）を指定します。アニメーションは、あらかじめシーンのJSONで定義されている必要があります。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>; "walk" という名前のアニメーションを再生
[anim_play name=walk]

; "jump_attack" という名前のアニメーションを再生
[anim_play name=jump_attack]
</code></pre>

<hr>

<h2>[set_visible]</h2>
<p>対象オブジェクトの表示・非表示を切り替えます。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>value</strong> (必須): <code>true</code>で表示、<code>false</code>で非表示にします。</li>
</ul>
<p><strong>使用例:</strong></p>
<pre><code>; オブジェクトを非表示にする
[set_visible value=false]

; オブジェクトを再表示する
[set_visible value=true]
</code></pre>
<hr>

<h2>[play_sound]</h2>
<p>効果音（SFX）を再生します。あらかじめ<code>asset_define.json</code>でオーディオアセットとして読み込んでおく必要があります。</p>
<h4>パラメータ:</h4>
<ul>
    <li><strong>key</strong> (必須): 再生したい効果音のアセットキー。</li>
    <li><strong>volume</strong> (任意): 音量。<code>0.0</code>（無音）から<code>1.0</code>（最大音量）の範囲で指定します。デフォルトは<code>1.0</code>。</li>
    <li><strong>loop</strong> (任意): <code>true</code>にすると、効果音がループ再生されます。<code>[stop_sound]</code>タグ（未実装）で停止させるまで鳴り続けます。デフォルトは<code>false</code>。</li>
</ul>
<p><strong>注意:</strong> このタグは音の再生を「開始」するだけで、再生が完了するのを待ちません。すぐに次のアクションの処理に移ります。</p>
<p><strong>使用例:</strong></p>
<pre><code>; "jump_sfx" というキーの効果音を再生
[play_sound key=jump_sfx]

; 敵を倒した時の音を、少し小さめの音量で再生
[play_sound key=enemy_defeat_sfx volume=0.7]

; アイテム取得音がループ再生される (特殊な演出)
[play_sound key=item_get_loop loop=true]
</code></pre>
<!-- ====================================================== -->
<h2>カスタムイベントトリガー (エディタ)</h2>
<p>PlayerControllerのような特定のコンポーネントが、自身の状態変化を知らせるために発行する、独自のイベントです。これにより、オブジェクトの内部状態とアニメーションやサウンドを、エディタだけで簡単に関連付けることができます。</p>
<!-- ====================================================== -->

<h3>onStateChange</h3>
<p><code>PlayerController</code>コンポーネントが、自身の状態（<code>idle</code>, <code>walk</code>, <code>jump_up</code>, <code>fall_down</code>）を変更した瞬間に一度だけ発火します。</p>
<h4>利用可能な変数 (Condition欄):</h4>
<ul>
    <li>
        <strong><code>state</code></strong>: 遷移先の<strong>新しい</strong>状態名（文字列）。
        <br>例: <code>'idle'</code>, <code>'walk'</code>, <code>'jump_up'</code>, <code>'fall_down'</code>
    </li>
    <li>
        <strong><code>oldState</code></strong>: 遷移元の<strong>古い</strong>状態名（文字列）。
    </li>
</ul>

<p><strong>使用例 (アニメーション連携):</strong></p>
<pre><code>
--- イベント1: 歩き始め ---
Trigger: onStateChange
Condition: state === 'walk'
Actions: [anim_play name=walk_animation]

--- イベント2: 停止 ---
Trigger: onStateChange
Condition: state === 'idle'
Actions: [anim_frame name=walk_animation frame=0]

--- イベント3: 歩行終了時 ---
Trigger: onStateChange
Condition: oldState === 'walk'
Actions: [anim_stop]
</code></pre>

<hr>

<h3>onDirectionChange</h3>
<p><code>PlayerController</code>コンポーネントが、キャラクターの向き（<code>left</code>, <code>right</code>）を変更した瞬間に一度だけ発火します。</p>
<h4>利用可能な変数 (Condition欄):</h4>
<ul>
    <li>
        <strong><code>direction</code></strong>: 新しい向き（文字列）。
        <br>例: <code>'left'</code>, <code>'right'</code>
    </li>
</ul>

<p><strong>使用例 (左右反転):</strong></p>
<pre><code>
--- イベント1: 左を向いた時 ---
Trigger: onDirectionChange
Condition: direction === 'left'
Actions: [set_flip_x value=true]

--- イベント2: 右を向いた時 ---
Trigger: onDirectionChange
Condition: direction === 'right'
Actions: [set_flip_x value=false]
</code></pre>
